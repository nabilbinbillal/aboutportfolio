"use strict";(()=>{var e,t,n,r,o={DEBUG_FLAG:"cronitor_rum_debug",TRACKING_ENABLED:"cronitor_rum_enable",TRACKING_DISABLED:"cronitor_rum_disable"},i=e=>window&&window.location.search.indexOf(e)>-1,a=()=>{let e=i(o.TRACKING_ENABLED),t=i(o.TRACKING_DISABLED);if(e||t){if(!window.localStorage){l("Can't disable Cronitor RUM. This browser does not support local storage.",void 0,!0);return}e&&(window.localStorage.removeItem(o.TRACKING_DISABLED),l("Cronitor RUM has been enabled on this device.",void 0,!0)),t&&(window.localStorage.setItem(o.TRACKING_DISABLED,"true"),l("Cronitor RUM has been disabled on this device.",void 0,!0))}},c=()=>{if(window.history.pushState&&!window.cronitor._historyPatched){l("Single page app mode is set to 'history', patching History API");let e=window.history.pushState,t=()=>ep("Pageview");window.history.pushState=function(){e.apply(this,arguments),t()},window.addEventListener("popstate",t),window.cronitor._historyPatched=!0,l("Listening for History API changes")}},l=(e,t,n)=>{let r=s.debug||i(o.DEBUG_FLAG);if(!n&&!r)return;let a=`[Cronitor RUM] ${e}`;t?console.log(a,t):console.log(a)},s={ingestionHost:"https://rum.cronitor.io",honorDNT:!1,filterLocalhost:!1,debug:!1,trackMode:"history",enabled:!0,autoTrackErrors:!0,autoTrackCoreWebVitals:!0},u=e=>(s={...s,...e},l("Updated configuration",s),s);function d(e,t){return{client_key:s.clientKey,environment:s.environment,event_name:e,user_agent:p(),url:f(),referrer:y(),language:m(),connection_type:h(),screen_width:S(),timezone:$(),...v(),...E(e),...t||{}}}var f=()=>{let e=s.includeURLFragment?window.location.hash:"",t=[];if(s.includeURLQueryParams&&s.includeURLQueryParams.length>0){let n=new URLSearchParams(window.location.search);for(let r of s.includeURLQueryParams)if(n.has(r)){let o=n.get(r);o?t.push(`${r}=${o}`):t.push(`${r}`)}}let i="";return t&&t.length>0&&(i=`?${t.join("&")}`),window.location.protocol+"//"+window.location.hostname+window.location.pathname+i+e},p=()=>window.navigator.userAgent,g=e=>{let t=window.location.search.match(e);return t?t[2]:void 0},v=()=>({utm_source:g(/[?&](ref|source|utm_source)=([^?&]+)/),utm_campaign:g(/[?&](utm_campaign)=([^?&]+)/),utm_medium:g(/[?&](utm_medium)=([^?&]+)/),utm_content:g(/[?&](utm_content)=([^?&]+)/),utm_term:g(/[?&](utm_term)=([^?&]+)/)}),m=()=>{let e=window.navigator;return e?e.userLanguage||e.language:void 0},$=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return}},h=()=>navigator.connection&&"effectiveType"in navigator.connection?navigator.connection.effectiveType:void 0,y=()=>{let e=document.referrer;if(e){let t=new URL(e);return t.hostname.toLowerCase()===window.location.hostname.toLowerCase()?void 0:t.protocol+"//"+t.hostname+t.pathname}},S=()=>null==window?void 0:window.innerWidth,b=e=>{try{if(!e)return;{let t=Math.ceil(e);return isNaN(t)||t<0?void 0:t}}catch{return}},E=e=>{let t={};if("Pageview"!==e||window.cronitor._initialPageLoadSent)return t;try{let n=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance||{};if(n.getEntriesByType){let r=n.getEntriesByType("navigation")[0];r&&(t={page_load_dns:r.domainLookupEnd-r.domainLookupStart,page_load_connect:r.connectEnd-r.connectStart,page_load_ssl:r.secureConnectionStart?r.requestStart-r.secureConnectionStart:void 0,page_load_ttfb:r.responseStart-r.requestStart,page_load_download:r.responseEnd-r.responseStart,page_load_dom_content_loaded:r.domContentLoadedEventEnd-r.responseEnd,page_load_render:r.domComplete-r.domContentLoadedEventEnd,page_load_total:r.loadEventStart,page_load_transfer_size:r.transferSize})}}catch(o){l("Error while loading performance metrics",o)}for(let i of Object.keys(t))t[i]=b(t[i]);return window.cronitor._initialPageLoadSent=!0,t},T=async(e,t)=>{let n=d(e,t),r=C(n);r&&w(r)&&await k(r)},k=async e=>{let t=`${s.ingestionHost}/api/rum/events`,n=JSON.stringify(e);navigator.sendBeacon?navigator.sendBeacon.call(navigator,t,n):await fetch(t,{body:n,method:"POST",credentials:"omit",keepalive:!0}),l("Sent events",e)},w=e=>{if(!s.clientKey)return l("Bad configuration: missing clientKey",void 0,!0),!1;if(!e.event_name||!/^[a-zA-Z][a-zA-Z0-9\_\-\.]{0,63}$/.test(e.event_name)){l("Invalid event name.",void 0,!0);return}if(window.localStorage&&window.localStorage.getItem(o.TRACKING_DISABLED)||!s.enabled)return l("Skipping event collection, Cronitor RUM has been manually disabled on this browser.",void 0,!0),!1;if(!s.debug){if(s.honorDNT&&"doNotTrack"in window.navigator&&"1"===window.navigator.doNotTrack)return l("Honoring 'Do Not Track'"),!1;if(s.filterLocalhost&&/^localhost$|^127(?:\.[0-9]+){0,2}\.[0-9]+$|^(?:0*\:)*?:?0*1$/.test(window.location.hostname))return l("Skipping event collection, localhost filter enabled",void 0,!0),!1;if("file:"===window.location.protocol)return l("Can't track from file URLs",void 0,!0),!1;if("prerender"===window.document.visibilityState)return l("Skipping event collection, document is pre-rendering"),!1;if(window.navigator.webdriver)return l("Skipping event collection, navigation is automated"),!1}if("Pageview"===e.event_name){let t=window.cronitor._previousPath,n=e.url;if(window.cronitor._previousPath=n,t&&t===n){l("Skipping event collection, duplicate pageview detected");return}}return!0},C=e=>{let t=e;if(s.beforeSend){let n;try{n=s.beforeSend({...e})}catch(r){console.error(r)}if(!n){l("beforeSend hook returned null or undefined, skipping event collection");return}for(let o of(n.client_key=e.client_key,Object.keys(e)))t[o]=n[o]}return t};function L(e,t){let n=!1;return(...r)=>{n||(n=!0,setTimeout(()=>{e(...r),n=!1},t))}}var _=-1,A=function(e){addEventListener("pageshow",function(t){t.persisted&&(_=t.timeStamp,e(t))},!0)},P=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},D=function(){var e=P();return e&&e.activationStart||0},I=function(e,t){var n=P(),r="navigate";return _>=0?r="back-forward-cache":n&&(r=document.prerendering||D()>0?"prerender":document.wasDiscarded?"restore":n.type.replace(/_/g,"-")),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},R=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})});return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch{}},B=function(e,t,n,r){var o,i;return function(a){var c,l;t.value>=0&&(a||r)&&((i=t.value-(o||0))||void 0===o)&&(o=t.value,t.delta=i,t.rating=(c=t.value,c>(l=n)[1]?"poor":c>l[0]?"needs-improvement":"good"),e(t))}},F=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},N=function(e){var t=function(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||e(t)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},U=function(e){var t=!1;return function(n){t||(e(n),t=!0)}},K=-1,G=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},M=function(e){"hidden"===document.visibilityState&&K>-1&&(K="visibilitychange"===e.type?e.timeStamp:0,W())},H=function(){addEventListener("visibilitychange",M,!0),addEventListener("prerenderingchange",M,!0)},W=function(){removeEventListener("visibilitychange",M,!0),removeEventListener("prerenderingchange",M,!0)},V=function(){return K<0&&(K=G(),H(),A(function(){setTimeout(function(){K=G(),H()},0)})),{get firstHiddenTime(){return K}}},z=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},q=[1800,3e3],x=function(e,t){t=t||{},z(function(){var n,r=V(),o=I("FCP"),i=R("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<r.firstHiddenTime&&(o.value=Math.max(e.startTime-D(),0),o.entries.push(e),n(!0)))})});i&&(n=B(e,o,q,t.reportAllChanges),A(function(r){o=I("FCP"),n=B(e,o,q,t.reportAllChanges),F(function(){o.value=performance.now()-r.timeStamp,n(!0)})}))})},O=[.1,.25],Q=function(e,t){t=t||{},x(U(function(){var n,r=I("CLS",0),o=0,i=[],a=function(e){e.forEach(function(e){if(!e.hadRecentInput){var t=i[0],n=i[i.length-1];o&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(o+=e.value,i.push(e)):(o=e.value,i=[e])}}),o>r.value&&(r.value=o,r.entries=i,n())},c=R("layout-shift",a);c&&(n=B(e,r,O,t.reportAllChanges),N(function(){a(c.takeRecords()),n(!0)}),A(function(){o=0,r=I("CLS",0),n=B(e,r,O,t.reportAllChanges),F(function(){return n()})}),setTimeout(n,0))}))},Z={passive:!0,capture:!0},j=new Date,J=function(r,o){e||(e=o,t=r,n=new Date,ee(removeEventListener),X())},X=function(){if(t>=0&&t<n-j){var o={entryType:"first-input",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+t};r.forEach(function(e){e(o)}),r=[]}},Y=function(e){if(e.cancelable){var t,n,r,o,i,a=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?(t=a,n=e,r=function(){J(t,n),i()},o=function(){i()},i=function(){removeEventListener("pointerup",r,Z),removeEventListener("pointercancel",o,Z)},addEventListener("pointerup",r,Z),addEventListener("pointercancel",o,Z)):J(a,e)}},ee=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach(function(t){return e(t,Y,Z)})},et=[100,300],en=function(n,o){o=o||{},z(function(){var i,a=V(),c=I("FID"),l=function(e){e.startTime<a.firstHiddenTime&&(c.value=e.processingStart-e.startTime,c.entries.push(e),i(!0))},s=function(e){e.forEach(l)},u=R("first-input",s);i=B(n,c,et,o.reportAllChanges),u&&N(U(function(){s(u.takeRecords()),u.disconnect()})),u&&A(function(){var a;c=I("FID"),i=B(n,c,et,o.reportAllChanges),r=[],t=-1,e=null,ee(addEventListener),a=l,r.push(a),X()})})},er=1/0,eo=[2500,4e3],ei={},ea=function(e,t){t=t||{},z(function(){var n,r=V(),o=I("LCP"),i=function(e){var t=e[e.length-1];t&&t.startTime<r.firstHiddenTime&&(o.value=Math.max(t.startTime-D(),0),o.entries=[t],n())},a=R("largest-contentful-paint",i);if(a){n=B(e,o,eo,t.reportAllChanges);var c=U(function(){ei[o.id]||(i(a.takeRecords()),a.disconnect(),ei[o.id]=!0,n(!0))});["keydown","click"].forEach(function(e){addEventListener(e,c,!0)}),N(c),A(function(r){o=I("LCP"),n=B(e,o,eo,t.reportAllChanges),F(function(){o.value=performance.now()-r.timeStamp,ei[o.id]=!0,n(!0)})})}})};function ec(){var e;null!=(e=null==window?void 0:window.cronitor)&&e._listeningForErrors||(window.addEventListener("error",ef),window.cronitor._listeningForErrors=!0,l("Listening for errors"))}function el(){var e;null!=(e=null==window?void 0:window.cronitor)&&e._listeningForErrors||(window.addEventListener("error",ef),window.cronitor._listeningForErrors=!0,l("Listening for errors"))}function es(){var e;if(null!=(e=null==window?void 0:window.cronitor)&&e._listeningForCoreWebVitals)return;let t=(e,t)=>n=>{ep(e,{[t]:n.value})};Q(t("WebVital","web_vital_cls")),en(t("WebVital","web_vital_fid")),ea(t("WebVital","web_vital_lcp")),window.cronitor._listeningForCoreWebVitals=!0,l("Listening for Core Web Vitals")}var eu,ed=(e,t,n={})=>{switch(e){case"config":if(!t)return l("Passed empty config params");eg(t);break;case"track":ep(t,n);break;case"captureError":ef(t,n);break;default:l("Unknown command",e,!0);return}},ef=L((e,t={})=>{var n,r;ep("Error",{error_type:(null==(n=e.error)?void 0:n.name)||"Error",message:(null==(r=e.error)?void 0:r.message)||e.message,lineno:e.lineno,colno:e.colno,filename:e.filename,...t})},1e3),ep=(e,t={})=>{let n=()=>T(e,t);"complete"===document.readyState?setTimeout(n,0):(l("Document not ready, adding event listener"),window.addEventListener("load",()=>{setTimeout(n,0)}))},eg=e=>{let t={...s},n=u(e);s.trackMode&&["pageload","history"].indexOf(s.trackMode)>-1&&("history"===s.trackMode&&c(),!t.clientKey&&n.clientKey&&(l("Triggering initial pageview"),ep("Pageview"))),l(`Tracking mode: ${s.trackMode}`)};(()=>{a();let e=window.cronitor&&window.cronitor.q||[];for(let t of(window.cronitor=ed,window.cronitor.q=e,e))window.cronitor.apply(void 0,t);s.autoTrackErrors&&ec(),s.autoTrackCoreWebVitals&&es()})()})();